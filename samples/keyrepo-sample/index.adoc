### Key repository sample

In this example, an encryption key reference is stored in the record payload.
The encryption key is generated by (and stored in) the key repository. Two records with the same record's key embbed the
same encryption key reference. The key repository in this example is a simple in memory repository but it would be a
key vault such as Google Cloud KMS or Hashicorp Vault in a real world example. The encryption keys are stored
encrypted (by a master key).


#### Running the sample

[source,indent=0]
....
cd samples/kafka-encryption-generatedkey-sample
docker-compose up # on windows and OSX, you need to adjust
sh generateMasterKey.sh
sh runSamples.sh
....

include::../../doc/running-docker-kafka.adoc[]

#### Usage

##### Producer side

[source,java,indent=0]
....
include::./src/main/java/io/quicksign/kafka/crypto/samples/keyrepo/SamplesMain.java[tags=masterkey]
....

[source,java,indent=0]
....
include::./src/main/java/io/quicksign/kafka/crypto/samples/keyrepo/SampleProducer.java[tags=produce]
....

##### Consumer side

[source,java,indent=0]
....
include::./src/main/java/io/quicksign/kafka/crypto/samples/keyrepo/SamplesMain.java[tags=masterkey]
....

[source,java,indent=0]
....
include::./src/main/java/io/quicksign/kafka/crypto/samples/keyrepo/SampleDecryptingConsumer.java[tags=consume]
....
